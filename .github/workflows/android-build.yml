name: Android CI - Build APK

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: æ£€å‡ºä»£ç 
      uses: actions/checkout@v4

    - name: è®¾ç½®JDK 17
      uses: actions/setup-java@v4
      with:
        java-version: '17'
        distribution: 'temurin'
        cache: gradle

    - name: è®¾ç½®Gradle Wrapper
      uses: gradle/gradle-build-action@v2

    - name: æˆäºˆGradleæ‰§è¡Œæƒé™
      run: chmod +x gradlew

    - name: æ„å»ºè°ƒè¯•ç‰ˆAPK
      run: ./gradlew assembleDebug --stacktrace

    - name: ä¸Šä¼ è°ƒè¯•ç‰ˆAPK
      uses: actions/upload-artifact@v4
      with:
        name: compassor-debug
        path: app/build/outputs/apk/debug/app-debug.apk

    - name: æ„å»ºä¿¡æ¯
      run: |
        echo "ğŸ‰ æ„å»ºå®Œæˆï¼"
        echo "ğŸ“± åº”ç”¨åŒ…å: com.growsnova.compassor.debug"
        echo "ğŸ“¦ APKå¤§å°: $(du -h app/build/outputs/apk/debug/app-debug.apk | cut -f1)"
        echo "âœ… ç‰ˆæœ¬: 1.0-DEBUG"
